# Changelog

Все изменения в проекте O-N-R (MZSA GEM).

## [Unreleased]

## [0.7.0] - 2025-12-02
### Добавлено
- **Telegram-уведомления о заказах**:
  - Автоматическая отправка уведомлений в Telegram при новом заказе.
  - Поддержка нескольких получателей (через `TELEGRAM_CHAT_IDS`).
  - Форматированное сообщение с эмодзи и HTML-разметкой.
  
- **Выбор изображений для Hero-карусели**:
  - Админка: добавлен выпадающий список предустановленных изображений.
  - Возможность указать свой URL или выбрать из списка.

### Изменено
- **send-order-confirmation**: Edge Function теперь отправляет Email + Telegram.
- **heroSlides.tsx**: Добавлен компонент выбора изображения из `AVAILABLE_IMAGES`.
- **Onboarding.tsx**: Обновлён текст раздела "Путь посетителя" — описание Smart Stock.

## [0.6.0] - 2025-12-01
### Добавлено
- **Управление остатками**:
  - Визуальная индикация наличия аксессуаров (зеленая галочка / красный крестик) в модальном окне прицепа.
  - Выбор количества аксессуаров с кнопками `+` и `-`.
  - Логика ограничения выбора количества на основе остатков (`stock`).
  - Скрытие точного количества остатков от пользователя (отображается только возможность добавить).

### Изменено
- **TrailerDetailsModal.tsx**: Добавлен выбор количества и проверка остатков.
- **Configurator.tsx**: Синхронизация логики выбора количества с модальным окном.
- **Документация**: Обновлены `DATA_MODELS.md` (поле `stock`) и `USER_GUIDE.md` (процесс заказа).

## [0.5.0] - 2025-12-01
### Добавлено
- **Feature-модули** (`src/features/`): Модульная архитектура для бизнес-логики
  - `trailers/trailerUtils.ts` — утилиты: getAxlesCount, getCapacity, hasBrakes, getMainImage, getAvailabilityLabel
  - `trailers/trailerConstants.ts` — константы: TRAILER_CATEGORIES, AVAILABILITY_LABELS, BODY_TYPES
  - `trailers/useTrailerFilters.ts` — хук фильтрации каталога (замена 100+ строк useMemo)
- **UI-компоненты** (`src/components/ui/`):
  - `Badge.tsx` — универсальные бейджи: Badge, NewBadge, SaleBadge, DiscountBadge, PopularBadge
  - `Price.tsx` — компонент цены с форматированием и скидками
  - `OptimizedImage.tsx` — оптимизированное изображение с lazy loading
- **SEO-компоненты** (`src/components/common/`):
  - `SEO.tsx` — микроданные schema.org: ProductSchema, BreadcrumbSchema, LocalBusinessSchema
  - `useMetaTags()` — хук для управления мета-тегами
- **Кастомные хуки** (`src/hooks/`):
  - `useHeroSlides.ts` — управление слайдами Hero карусели
  - `useStores.ts` — работа с магазинами/филиалами
- **Админ-ресурсы** (`src/admin/resources/`):
  - `heroSlides.tsx` — управление Hero-каруселью на главной
  - `stores.tsx` — управление магазинами/филиалами
  - `warehouses.tsx` — управление складами
  - `import1c.tsx` — импорт данных из 1С (stub)

### Изменено
- **TrailerCard.tsx**: Рефакторинг — использование Badge, Price компонентов и утилит из features/trailers
- **Catalog.tsx**: Рефакторинг — замена useMemo на useTrailerFilters хук, добавление BreadcrumbSchema для SEO
- **Home.tsx**: Добавление LocalBusinessSchema для SEO микроданных
- **Документация**: Полное обновление всех инструкций и архитектурных документов

### Удалено
- Дублирующийся код из TrailerCard.tsx (~60 строк helper-функций)
- Дублирующаяся логика фильтрации из Catalog.tsx (~100 строк useMemo)

## [0.4.0] - 2025-12-01
### Добавлено
- **Supabase миграция**: Добавлены поля `max_vehicle_length`, `max_vehicle_width`, `max_vehicle_weight` в таблицу `trailers`
- **Маппинг полей**: `supabaseProvider.ts` теперь маппит `max_vehicle_*` → `maxVehicle*` для конфигуратора

### Изменено
- **searchParser.ts**: Исправлен порядок regex-паттернов (мм перед м) для корректного парсинга "4000 мм"
- **TrailerCard.tsx**: Добавлена функция `cleanDimension()` для очистки данных bodyDimensions от мусора
- **Configurator.tsx**: Уменьшены отступы (pt-8→pt-4, pb-20→pb-12), автопереход на шаг 2 при поиске
- **Home.tsx**: Исправлена типизация `NodeJS.Timeout` → `ReturnType<typeof setInterval>`

### Исправлено
- **Умный поиск**: "4000 мм" теперь корректно парсится как 4000мм (не 4000000мм)
- **Карточки прицепов**: Отображение "4300 мм мм судно" → "4300 мм"

### Документация
- Обновлены `DATA_MODELS.md`, `ARCHITECTURE.md`, `copilot-instructions.md` с новыми полями

## [0.3.0] - 2025-01-XX
### Добавлено
- **Настраиваемый API URL**: Переменная окружения `VITE_API_URL` для конфигурации backend URL.
- **Файл `.env.example`**: Шаблон переменных окружения для фронтенда.

### Изменено
- **TrailerCard.tsx**: Логика кнопок — "Купить" для `in_stock`, "Заказать" для остальных статусов наличия.
- **Header.tsx**: Новое мобильное меню (slide-in слева) с glassmorphism-эффектами (`backdrop-blur-xl`, `bg-white/80`).
- **Catalog.tsx**: Строка поиска перемещена над фильтрами и категориями.
- **CatalogSearch.tsx**: Компонент на всю ширину с улучшенным плейсхолдером.
- **CatalogFilters.tsx**: Убран дублирующий sticky-контейнер.
- **Footer.tsx, Header.tsx**: Обновлены контактные данные.

### Исправлено
- **Контактные данные**: Заменены все хардкод-плейсхолдеры на реальные данные с o-n-r.ru:
  - Телефон: +7 (3462) 22-33-55
  - Email: info@o-n-r.ru
  - 4 филиала: Сургут, Нижневартовск, Ноябрьск, Новый Уренгой
- **Логотип**: Исправлен путь и заменён на корректный файл `onr-logo.png`.
- **Документация**: Обновлены `copilot-instructions.md`, `conventions.md`, `tech_stack.md`.

## [0.2.0] - 2025-11-19
### Добавлено
- **Отслеживание заказов**: Пользователи могут видеть историю своих заказов и их текущий статус в личном кабинете.
- **Ролевая модель (RBAC)**:
  - Роли: `admin`, `manager`, `user`.
  - Разграничение доступа в Админ-панели:
    - `admin`: Полный доступ (Заказы, Прицепы, Аксессуары, Клиенты, Настройки).
    - `manager`: Ограниченный доступ (Нет доступа к Настройкам).
- **Mock Data**:
  - Добавлен файл `src/data/orders.ts` с тестовыми заказами.
  - Реализована инициализация LocalStorage тестовыми данными при первом запуске.
- **UI Профиля**:
  - Отображение списка заказов с цветовой индикацией статусов.
  - Timeline (хронология) для быстрого просмотра последнего события по заказу.

### Изменено
- **AuthContext**: Логика определения роли пользователя перенесена на проверку email (содержит "admin" -> admin, "manager" -> manager).
- **Admin AuthProvider**: Обновлен для поддержки множественных учетных записей (`admin`/`admin123`, `manager`/`manager123`).
- **LocalStorageProvider**: Метод `initializeData` теперь принимает и сохраняет массив заказов.

### Исправлено
- Типизация интерфейса `Trailer` (добавлено поле `specs` для соответствия мок-данным).

## [0.1.0] - 2025-11-18
### Добавлено
- **Базовая структура проекта**: Vite + React + TypeScript.
- **Админ-панель**: Интеграция `react-admin`.
- **Каталог**: Просмотр прицепов и аксессуаров.
- **Конфигуратор**: Базовая логика подбора прицепа (UI).
- **LocalStorage Provider**: Эмуляция бэкенда на клиенте.
